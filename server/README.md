# Brain Monitor Backend Server

è„‘ç”µæ³¢ç›‘æµ‹ç³»ç»Ÿåç«¯æœåŠ¡ï¼ŒåŸºäº Node.js + Express + MySQL æ„å»ºã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ” è®¤è¯ç³»ç»Ÿ
- **æœºæ„ç™»å½•**: æ”¯æŒæœºæ„IDå’Œå¯†ç éªŒè¯ï¼Œä¹Ÿå…è®¸ç©ºè¾“å…¥ç›´æ¥ç™»å½•
- **åŒ»æŠ¤äººå‘˜æ³¨å†Œ**: å®Œæ•´çš„åŒ»æŠ¤äººå‘˜æ³¨å†Œæµç¨‹ï¼ŒåŒ…å«å¯†ç åŠ å¯†
- **åŒ»æŠ¤äººå‘˜ç™»å½•**: JWT tokenè®¤è¯ï¼Œæ”¯æŒä¼šè¯ç®¡ç†
- **æƒé™æ§åˆ¶**: åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼Œç¡®ä¿æ•°æ®å®‰å…¨

### ğŸ‘¥ æµ‹è¯•è€…ç®¡ç†
- **æµ‹è¯•è€…åˆ—è¡¨**: è·å–å½“å‰åŒ»æŠ¤äººå‘˜çš„æµ‹è¯•è€…åˆ—è¡¨
- **æ·»åŠ æµ‹è¯•è€…**: åˆ›å»ºæ–°çš„æµ‹è¯•è€…è®°å½•
- **æœç´¢åŠŸèƒ½**: æ”¯æŒæŒ‰IDæˆ–å§“åæœç´¢æµ‹è¯•è€…
- **æƒé™éªŒè¯**: ç¡®ä¿åŒ»æŠ¤äººå‘˜åªèƒ½è®¿é—®è‡ªå·±çš„æµ‹è¯•è€…

### ğŸ“Š æµ‹è¯•è®°å½•ç®¡ç†
- **åˆ›å»ºæµ‹è¯•**: ä¸ºæµ‹è¯•è€…åˆ›å»ºæ–°çš„æµ‹è¯•è®°å½•
- **çŠ¶æ€æ›´æ–°**: æ”¯æŒæµ‹è¯•çŠ¶æ€ã€è¯„åˆ†ã€æ¡åŠ›ç­‰ä¿¡æ¯çš„æ›´æ–°
- **æµ‹è¯•å†å²**: æŸ¥çœ‹æµ‹è¯•è€…çš„å®Œæ•´æµ‹è¯•å†å²è®°å½•
- **æ•°æ®å®Œæ•´æ€§**: ä½¿ç”¨äº‹åŠ¡ç¡®ä¿æ•°æ®ä¸€è‡´æ€§

### ğŸ§  è„‘ç”µæ³¢æ•°æ®ç®¡ç†
- **æ•°æ®ä¸Šä¼ **: æ”¯æŒæ‰¹é‡ä¸Šä¼ è„‘ç”µæ³¢æ•°æ®
- **æ•°æ®å­˜å‚¨**: é«˜æ•ˆå­˜å‚¨å¤§é‡è„‘ç”µæ³¢æ•°æ®ç‚¹
- **æ•°æ®ç±»å‹**: æ”¯æŒççœ¼ã€é—­çœ¼ç­‰ä¸åŒæµ‹è¯•ç±»å‹çš„æ•°æ®
- **å®æ—¶å¤„ç†**: æ”¯æŒå®æ—¶æ•°æ®æµå¤„ç†

### ğŸ“ˆ æµ‹è¯•ç»“æœç®¡ç†
- **ç»“æœä¿å­˜**: ä¿å­˜å„ç§è„‘ç”µæ³¢åˆ†æç»“æœ
- **å¤šç±»å‹ç»“æœ**: æ”¯æŒççœ¼ã€é—­çœ¼ã€ç»¼åˆç­‰ä¸åŒç±»å‹çš„ç»“æœ
- **æ•°æ®å¯¼å‡º**: æ”¯æŒCSVæ ¼å¼çš„æ•°æ®å¯¼å‡º
- **ç»Ÿè®¡åˆ†æ**: æä¾›æ•°æ®ç»Ÿè®¡å’Œåˆ†æåŠŸèƒ½

## æŠ€æœ¯æ¶æ„

### åç«¯æŠ€æœ¯æ ˆ
- **Node.js**: è¿è¡Œç¯å¢ƒ
- **Express**: Webæ¡†æ¶
- **MySQL**: å…³ç³»å‹æ•°æ®åº“
- **JWT**: èº«ä»½è®¤è¯
- **bcryptjs**: å¯†ç åŠ å¯†
- **Helmet**: å®‰å…¨ä¸­é—´ä»¶
- **CORS**: è·¨åŸŸæ”¯æŒ

### æ•°æ®åº“è®¾è®¡
- **institutions**: æœºæ„ä¿¡æ¯è¡¨
- **medical_staff**: åŒ»æŠ¤äººå‘˜è¡¨
- **testers**: æµ‹è¯•è€…è¡¨
- **test_records**: æµ‹è¯•è®°å½•è¡¨
- **brainwave_data**: è„‘ç”µæ³¢æ•°æ®è¡¨
- **test_results**: æµ‹è¯•ç»“æœè¡¨

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Node.js >= 14.0.0
- MySQL >= 8.0.0
- npm æˆ– yarn

### å®‰è£…æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**
```bash
git clone <repository-url>
cd brain-monitor-server
```

2. **å®‰è£…ä¾èµ–**
```bash
npm install
```

3. **ç¯å¢ƒé…ç½®**
```bash
cp env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®æ•°æ®åº“è¿æ¥ä¿¡æ¯
```

4. **æ•°æ®åº“åˆå§‹åŒ–**
```bash
# ä½¿ç”¨ MySQL å®¢æˆ·ç«¯æ‰§è¡Œ database/schema.sql
mysql -u root -p < database/schema.sql
```

5. **å¯åŠ¨æœåŠ¡**
```bash
# å¼€å‘æ¨¡å¼
npm run dev

# ç”Ÿäº§æ¨¡å¼
npm start
```

### ç¯å¢ƒå˜é‡é…ç½®

```env
# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=your_password
DB_NAME=brain_monitor

# JWTé…ç½®
JWT_SECRET=your_jwt_secret_key_here
JWT_EXPIRES_IN=24h

# æœåŠ¡å™¨é…ç½®
PORT=3000
NODE_ENV=development
```

## API æ¥å£æ–‡æ¡£

### è®¤è¯æ¥å£

#### æœºæ„ç™»å½•
```
POST /api/auth/institution/login
Content-Type: application/json

{
  "institutionId": "æœºæ„ID",
  "password": "å¯†ç "
}
```

#### åŒ»æŠ¤äººå‘˜æ³¨å†Œ
```
POST /api/auth/medical-staff/register
Content-Type: application/json

{
  "staffId": "å·¥å·",
  "name": "å§“å",
  "account": "è´¦å·",
  "password": "å¯†ç ",
  "phone": "ç”µè¯",
  "department": "ç§‘å®¤",
  "position": "èŒä½",
  "institutionId": "æœºæ„ID"
}
```

#### åŒ»æŠ¤äººå‘˜ç™»å½•
```
POST /api/auth/medical-staff/login
Content-Type: application/json

{
  "account": "è´¦å·",
  "password": "å¯†ç "
}
```

### æµ‹è¯•è€…ç®¡ç†æ¥å£

#### è·å–æµ‹è¯•è€…åˆ—è¡¨
```
GET /api/testers/my-testers?search=å…³é”®è¯
Authorization: Bearer <token>
```

#### æ·»åŠ æµ‹è¯•è€…
```
POST /api/testers
Authorization: Bearer <token>
Content-Type: application/json

{
  "testerId": "æµ‹è¯•è€…ID",
  "name": "å§“å",
  "age": "å¹´é¾„",
  "gender": "æ€§åˆ«",
  "phone": "ç”µè¯"
}
```

### æµ‹è¯•è®°å½•æ¥å£

#### åˆ›å»ºæµ‹è¯•è®°å½•
```
POST /api/test-records
Authorization: Bearer <token>
Content-Type: application/json

{
  "testerId": "æµ‹è¯•è€…ID"
}
```

#### æ›´æ–°æµ‹è¯•çŠ¶æ€
```
PUT /api/test-records/:recordId/status
Authorization: Bearer <token>
Content-Type: application/json

{
  "testStatus": "å·²å®Œæˆ",
  "testEndTime": "2024-01-01T12:00:00Z",
  "mocaScore": 25,
  "mmseScore": 28,
  "gripStrength": 35.5
}
```

### è„‘ç”µæ³¢æ•°æ®æ¥å£

#### ä¸Šä¼ è„‘ç”µæ³¢æ•°æ®
```
POST /api/brainwave-data/upload
Authorization: Bearer <token>
Content-Type: application/json

{
  "testRecordId": "æµ‹è¯•è®°å½•ID",
  "dataType": "ççœ¼",
  "dataPoints": [1.2, 1.5, 1.8, ...]
}
```

### æµ‹è¯•ç»“æœæ¥å£

#### ä¿å­˜æµ‹è¯•ç»“æœ
```
POST /api/test-results
Authorization: Bearer <token>
Content-Type: application/json

{
  "testRecordId": "æµ‹è¯•è®°å½•ID",
  "resultType": "ççœ¼",
  "alphaPower": 0.15,
  "betaPower": 0.25,
  "thetaPower": 0.10,
  "deltaPower": 0.05,
  "gammaPower": 0.30,
  "totalPower": 0.85,
  "dominantFrequency": 12.5,
  "coherenceScore": 0.75,
  "attentionScore": 0.80,
  "relaxationScore": 0.70
}
```

## æ•°æ®æµç¨‹

### æµ‹è¯•æµç¨‹
1. **æœºæ„ç™»å½•** â†’ è·å–æœºæ„ä¿¡æ¯
2. **åŒ»æŠ¤äººå‘˜ç™»å½•** â†’ è·å–JWT token
3. **é€‰æ‹©æµ‹è¯•è€…** â†’ ä»æµ‹è¯•è€…åˆ—è¡¨ä¸­é€‰æ‹©
4. **å¼€å§‹æµ‹è¯•** â†’ åˆ›å»ºæµ‹è¯•è®°å½•
5. **æ•°æ®é‡‡é›†** â†’ å®æ—¶ä¸Šä¼ è„‘ç”µæ³¢æ•°æ®
6. **æµ‹è¯•å®Œæˆ** â†’ æ›´æ–°æµ‹è¯•çŠ¶æ€å’Œè¯„åˆ†
7. **ç»“æœåˆ†æ** â†’ ä¿å­˜æµ‹è¯•åˆ†æç»“æœ

### æ•°æ®å®‰å…¨
- æ‰€æœ‰æ•æ„Ÿæ“ä½œéƒ½éœ€è¦JWTè®¤è¯
- åŒ»æŠ¤äººå‘˜åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
- ä½¿ç”¨äº‹åŠ¡ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- å¯†ç ä½¿ç”¨bcryptåŠ å¯†å­˜å‚¨

## éƒ¨ç½²è¯´æ˜

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
1. è®¾ç½® `NODE_ENV=production`
2. é…ç½®ç”Ÿäº§æ•°æ®åº“è¿æ¥
3. ä½¿ç”¨PM2æˆ–Dockerè¿›è¡Œè¿›ç¨‹ç®¡ç†
4. é…ç½®åå‘ä»£ç†ï¼ˆNginxï¼‰
5. å¯ç”¨HTTPS

### æ€§èƒ½ä¼˜åŒ–
- æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–
- æŸ¥è¯¢ç´¢å¼•ä¼˜åŒ–
- æ•°æ®åˆ†é¡µå¤„ç†
- ç¼“å­˜ç­–ç•¥

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **æ•°æ®åº“è¿æ¥å¤±è´¥**: æ£€æŸ¥æ•°æ®åº“é…ç½®å’Œç½‘ç»œè¿æ¥
2. **JWTéªŒè¯å¤±è´¥**: æ£€æŸ¥tokenæ ¼å¼å’Œå¯†é’¥é…ç½®
3. **æƒé™ä¸è¶³**: ç¡®è®¤ç”¨æˆ·èº«ä»½å’Œè®¿é—®æƒé™
4. **æ•°æ®ä¸Šä¼ å¤±è´¥**: æ£€æŸ¥æ•°æ®æ ¼å¼å’Œå¤§å°é™åˆ¶

### æ—¥å¿—æŸ¥çœ‹
```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
npm run dev

# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
tail -f /var/log/mysql/error.log
```

## è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»º Pull Request

## è®¸å¯è¯

MIT License

## è”ç³»æ–¹å¼

- é¡¹ç›®ç»´æŠ¤è€…: Brain Monitor Team
- é‚®ç®±: support@brainmonitor.com
- é¡¹ç›®åœ°å€: https://github.com/brainmonitor/server

